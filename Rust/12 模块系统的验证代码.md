æ•²å…¥ [cargo new mod_atlas --lib](10.1%20cargo%20new.md) å‘½ä»¤åˆ›å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œç„¶åå‚è€ƒä»¥ä¸‹ç»“æ„ç»™è¿™ä¸ªé¡¹ç›®æ·»åŠ ç›¸å…³çš„ç›®å½•åŠæ–‡ä»¶

```
src/
â”œâ”€â”€ main.rs
â”œâ”€â”€ lib.rs
â”œâ”€â”€ child.rs
â”œâ”€â”€ child/
â”‚   â””â”€â”€ grandchild.rs
â””â”€â”€ sibling.rs
```

æˆ‘ä»¬å°†é€šè¿‡è¿™ä¸ªç»“æ„ï¼Œç²¾å‡†éªŒè¯[æ¨¡å—ç³»ç»Ÿå…¨æŒ‡å— (2018+ ç‰ˆ)](<12%20æ¨¡å—ç³»ç»Ÿå…¨æŒ‡å—%20(2018+%20ç‰ˆ).md>)ä¸­è¿‡æåˆ°çš„ç‰©ç†æŒ‚è½½ã€å¯è§æ€§è¾¹ç•Œä»¥åŠè·¯å¾„å¯¼èˆªã€‚

### 1. ç‰©ç†ç»“æ„ä¸æŒ‚è½½ (Verification: Physical Structure)

- **`src/lib.rs`**: ä½œä¸ºåº“çš„æ ¹ï¼Œå£°æ˜ `child` å’Œ `sibling`ã€‚
- **`src/main.rs`**: ä½œä¸ºäºŒè¿›åˆ¶å…¥å£ï¼ŒéªŒè¯ä»å¤–éƒ¨è°ƒç”¨åº“ã€‚

---

### 2. å®Œæ•´ä»£ç å®ç°

#### ã€åº“æ ¹èŠ‚ç‚¹ã€‘ `src/lib.rs`

éªŒè¯ï¼šæ ¹èŠ‚ç‚¹æŒ‚è½½ã€ç§æœ‰æ€§ä¿æŠ¤ã€‚

```rust
// åŠ è½½ macros.rs å¹¶æŠŠé‡Œé¢å®šä¹‰çš„æ‰€æœ‰å®â€˜å…¨å±€åŒ–â€™
#[macro_use]
mod macros;

pub mod child;
mod sibling; // x æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰ lib å’Œå®ƒçš„åä»£èƒ½çœ‹
pub use sibling::visit as sibling_visit_re; // ä¾› main.rs è°ƒç”¨
pub const PUBLIC: &str = "ok";
const PRIVATE: &str = "ok";

pub fn visit() {
    header!("Crate Root");
    // 1. è®¿é—®å­æ¨¡å— child (å…¬å¼€)
    inspect!(child::PUBLIC);
    // inspect!(child::PRIVATE);           // âŒ æ— æ³•è®¿é—®å­æ¨¡å—ç§æœ‰æˆå‘˜
    inspect!(child::PRIVATE, X);           // âŒ æ— æ³•è®¿é—®å­æ¨¡å—ç§æœ‰æˆå‘˜

    // 2. è®¿é—®å­æ¨¡å— sibling (ç§æœ‰ï¼Œä½† lib æ˜¯çˆ¶æ¨¡å—ï¼Œæœ‰æƒè¿›å…¥)
    inspect!(sibling::PUBLIC);
    // inspect!(sibling::PRIVATE);           // âŒ è¿™ä¸ªæ›´ä¸è¡Œ
    inspect!(sibling::PRIVATE, X);           // âŒ è¿™ä¸ªæ›´ä¸è¡Œ

    // 3. è®¿é—®ã€Œå­™ã€æ¨¡å—
    inspect!(child::grandchild::PUB_CRATE);
    // inspect!(child::grandchild::PRIVATE); // âŒ å„¿å­çš„éšç§éƒ½çœ‹ä¸åˆ°ï¼Œæ›´åˆ«æƒ³çœ‹å­™å­çš„
    inspect!(child::grandchild::PRIVATE, X); // âŒ å„¿å­çš„éšç§éƒ½çœ‹ä¸åˆ°ï¼Œæ›´åˆ«æƒ³çœ‹å­™å­çš„
}
```

#### ã€å­æ¨¡å—ã€‘ `src/child.rs`

éªŒè¯ï¼šåŒåæ–‡ä»¶å¤¹å­æ¨¡å—æŒ‚è½½ã€`pub(crate)` æƒé™ã€‚

```rust
pub mod grandchild;

pub const PUBLIC: &str = "ok";
const PRIVATE: &str = "ok";

pub fn visit() {
    header!("Sub Mod");

    // 1. è®¿é—®çˆ¶æ¨¡å— lib    inspect!(super::PUBLIC);
    inspect!(super::PRIVATE);     // âœ…çˆ¶è¾ˆéšç§é€æ˜åŒ–ï¼Œå¯è®¿

    // 2. è®¿é—®å­æ¨¡å— b    inspect!(grandchild::PUB_CRATE);
    inspect!(grandchild::PUB_SUPER);
    // inspect!(grandchild::PRIVATE);            // âŒ æ— æ³•è®¿é—®å­æ¨¡å—çš„ç§æœ‰æˆå‘˜
    inspect!(grandchild::PRIVATE, X);            // âŒ æ— æ³•è®¿é—®å­æ¨¡å—çš„ç§æœ‰æˆå‘˜

    // 3. è®¿é—®å…„å¼Ÿæ¨¡å—
    // è™½ç„¶ sibling åœ¨ lib é‡Œæ˜¯ç§æœ‰çš„ï¼Œä½† child å¯ä»¥é€šè¿‡ super::sibling è®¿é—®å®ƒï¼ˆç¬¦åˆã€Œçˆ¶å¯¹å­æ— éšç§ã€çš„è§„åˆ™ï¼‰
    // child å¯ä»¥è¿›ä¸€æ­¥è®¿é—® super::sibling::PUBLIC    // child ä¸å¯ä»¥è¿›ä¸€æ­¥è®¿é—® super::sibling::PRIVATEï¼ˆç¬¦åˆã€Œå…„å¼Ÿä¹‹é—´æœ‰éšç§ã€çš„è§„åˆ™ï¼‰
    inspect!(super::sibling::PUBLIC);         // å…„å¼Ÿ pub å¯è®¿
    // inspect!(crate::sibling::PRIVATE);     // âŒ å…„å¼Ÿéšç§ä¸å¯è®¿
    inspect!(crate::sibling::PRIVATE, X);     // âŒ å…„å¼Ÿéšç§ä¸å¯è®¿
}
```

#### ã€å­™æ¨¡å—ã€‘ `src/child/grandchild.rs`

éªŒè¯ï¼šæ·±å±‚åµŒå¥—è®¿é—®ã€`super` ä¸ `crate` å¯¼èˆªã€‚

```rust
// æœ¬æ¨¡å—çš„å˜é‡å®šä¹‰
const PRIVATE: &str = "ok";
pub const PUBLIC: &str = "ok";
pub(crate) const PUB_CRATE: &str = "ok";
pub(super) const PUB_SUPER: &str = "ok";

pub fn visit() {
    header!("Deep Mod");

    // 1. è®¿é—®çˆ¶æ¨¡å—è‚¯å®šæ²¡é—®é¢˜ï¼ˆåœ¨ child ä¸­å·²éªŒè¯ï¼‰
    // 2. è®¿é—®ã€Œç¥–çˆ¶ã€
inspect!(super::super::PUBLIC); // å•°å—¦
    inspect!(crate::PRIVATE); // âœ… çˆ·å¯¹å­™äº¦æ— éšç§

    // 3. è®¿é—®ã€Œè¿œäº²ã€
inspect!(crate::sibling::PUBLIC);
    // inspect!(crate::sibling::PRIVATE); // âŒ æ— æ³•è®¿é—®ã€Œçˆ¶ä¹‹å…„å¼Ÿã€æ¨¡å—çš„ç§æœ‰æˆå‘˜
    inspect!(crate::sibling::PRIVATE, X); // âŒ æ— æ³•è®¿é—®ã€Œçˆ¶ä¹‹å…„å¼Ÿã€æ¨¡å—çš„ç§æœ‰æˆå‘˜
    // inspect!(super::super::sibling::PRIVATE); // âŒ æ¢ç§å†™æ³•ç…§æ ·ä¸è¡Œ
    inspect!(super::super::sibling::PRIVATE, X); // âŒ æ¢ç§å†™æ³•ç…§æ ·ä¸è¡Œ
}
```

#### ã€ç§æœ‰å­æ¨¡å—ã€‘ `src/sibling.rs`

éªŒè¯ï¼šå…„å¼Ÿæ¨¡å—äº’è®¿ã€‚

```rust
pub const PUBLIC: &str = "ok";
const PRIVATE: &str = "ok";

pub fn visit() {
    header!("Private Sub-mod");

    // 1. è®¿é—®çˆ¶æ¨¡å— lib    inspect!(super::PUBLIC);
    inspect!(super::PRIVATE);

    // 2. è®¿é—®å…„å¼Ÿæ¨¡å— child    inspect!(super::child::PUBLIC);
    inspect!(super::child::grandchild::PUBLIC);
}
```

#### ã€äºŒè¿›åˆ¶å…¥å£ã€‘ `src/main.rs`

éªŒè¯ï¼šå¤–éƒ¨å¯¹åº“çš„è°ƒç”¨é™åˆ¶ã€‚

```rust
use mod_atlas::{child, visit, sibling_visit_re};

fn main() {
    println!("--- MAIN_RS START ---");

    // è®¿é—®å„æ¨¡å—çš„å…¥å£å‡½æ•°
    visit();
    child::visit();
    child::grandchild::visit();
    // mod_atlas::sibling::visit(); // âŒ æ¨¡å— sibling æ˜¯ç§æœ‰çš„ï¼Œè™½ç„¶å®ƒåœ¨ lib é‡Œï¼Œä½† main çœ‹ä¸è§å®ƒ
    sibling_visit_re();          // âœ… ä½†å¯ä»¥è®¿é—®ç§æœ‰æ¨¡å—ä¸­é‡æ–°å¯¼å‡ºçš„æˆå‘˜

    //  æƒé™æµ‹è¯•
    // println!("{}", mod_atlas::child::PRIVATE); // âŒ
    // println!("{}", mod_atlas::sibling::PUBLIC); // âŒ æ— æ³•è®¿é—®ç§æœ‰æ¨¡å—çš„ä»»ä½•æˆå‘˜

    println!();
}
```

#### ã€è‡ªå®šä¹‰çš„å®ã€‘src/macros.rs

```rust
/// å®šä¹‰å…¨å±€å·¡æ£€å®
#[macro_export]
macro_rules! inspect {
    ($exp:expr) => {
        // ä½¿ç”¨ stringify! æ•è·è¡¨è¾¾å¼æºç ï¼Œç”±ç¼–è¯‘å™¨æ±‚å€¼
        println!("  {:>35} => {}", stringify!($exp).trim(), $exp);
    };

    // ä¸“é—¨å¤„ç†å·²çŸ¥æ— æ³•è®¿é—®çš„ä»£ç å—
    ($exp:expr, X) => {
        println!("  {:>35} => error", stringify!($exp));
    };
}

#[macro_export]
macro_rules! header {
    () => {
        {
            let path = module_path!();
            println!("\n{:=^60}", "");
            println!(" ğŸŒ SCOPE: {}", path);
            println!("{:-^60}\n", "");
        }
    };
    ($msg:expr) => {
        {
            let path = module_path!();
            println!("\n{:=^60}", "");
            println!(" ğŸŒ SCOPE: {} ({})", path, $msg);
            println!("{:-^60}\n", "");
        }
    };
}
```

---

### åœ¨ `main.rs` ä¸­å¼•ç”¨åº“

ç›¸å…³ç¬”è®°

- [12 åœ¨ main.rs ä¸­å¼•ç”¨åº“ä»£ç ](12%20åœ¨%20main.rs%20ä¸­å¼•ç”¨åº“ä»£ç .md)
- [12 main ä½¿ç”¨ use é€šé…ç¬¦](12%20main%20ä½¿ç”¨%20use%20é€šé…ç¬¦.md)
