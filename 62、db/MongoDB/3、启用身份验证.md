MongoDB 在首次安装后，默认**没有任何用户**。也就是说，admin 数据库和其他数据库中都没有用户，任何人都可以直接连接和操作数据库。这种状态称为“无认证模式”或“未启用访问控制”。

只有在你启用身份验证（authorization: enabled）后，才需要通过用户认证访问数据库。此时你需要手动创建第一个管理员用户。

如果 MongoDB 是通过 Homebrew 安装的， 默认配置文件路径为 `/opt/homebrew/etc/mongod.conf`（Apple Silicon）。可以直接修改这个文件来启用身份验证等自定义配置。

### 1. 编辑 mongod.conf 启用身份验证

终端敲入 `nano /opt/homebrew/etc/mongod.conf` 命令，复制并粘贴以下内容到文件末尾：

```
security:
  authorization: enabled
```

按 `Ctrl + X` 保存并关闭文件。

### 2. 重启 MongoDB 服务

使用 Homebrew 重启 MongoDB 服务：

```
brew services restart mongodb-community
```

### 3. 创建管理员用户

首次启用身份验证后，MongoDB 提供“localhost exception”，允许你在本地无需认证创建第一个用户。操作如下：

- 打开终端，连接 MongoDB：

```
mongosh
```

- 切换到 admin 数据库并创建管理员用户（例如 myAdmin）：

```js
use admin
db.createUser({
  user: "zdt",
  pwd: passwordPrompt(), // 回车后输入密码
  roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
})
```

按提示输入密码。

### 4. 认证登录

以后你需要用管理员身份登录：

```
mongosh -u "myAdmin" -p --authenticationDatabase "admin"
```

或在 mongosh 里：

```
use admindb.auth("myAdmin", passwordPrompt())
```

### 5. 创建其他用户（可选）

登录后可继续创建其他具有不同权限的用户。

这样就完成了身份验证的启用和管理员用户的创建。

### 关于升级时的行为

- 执行 `brew upgrade mongodb-community` 命令时，Homebrew 通常不会自动覆盖你已经修改过的 mongod.conf 文件。Homebrew 的惯例是：如果配置文件有用户更改，升级时会保留你的更改，并可能生成一个新的 .conf 文件（如 mongod.conf.default 或 mongod.conf.new），供你手动对比和合并。
- 你的自定义配置不会因为升级而丢失，但新版本可能会带来新的配置项或默认值。此时你需要手动对比新旧配置文件，决定是否合并新参数。
- 如果你一直使用 `/opt/homebrew/etc/mongod.conf`，升级后 mongod 依然会读取这个文件，不会因为升级而“失效”。
- 新版本的 mongod.conf 文件如果有变化，Homebrew 可能会以 mongod.conf.default 或 mongod.conf.sample 的形式提供，你可以参考这些文件来更新你的配置。
